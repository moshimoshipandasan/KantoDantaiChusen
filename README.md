# 関東高等学校剣道大会団体抽選プログラム

## 概要
このプログラムは、関東高等学校剣道大会における団体戦の抽選を自動化するためのGoogle Apps Script（GAS）です。各都県の1位から4位までの高校と5位以下の高校を抽選で配置し、公平な大会運営をサポートします。

## 機能
- 抽選順の決定
- 団体戦の自動抽選
- 試合順の決定
- シートの初期化

## 使用方法
1. [テンプレートスプレッドシート](https://docs.google.com/spreadsheets/d/1sGLfFybTI5P0fmbMQTrmxd_Wwb_ouXLY7TNxmrwwEtg/copy)をコピーして開く
2. 「抽選ツール」メニューが表示される
3. 「初期化」を選択してシートを初期化する
4. 「抽選順決定」を選択して各都県の抽選順を決定する
5. 「団体戦自動抽選」を選択して団体戦の抽選を実行する

## シート構成
- **校名シート**: 各都県の学校情報を管理
  - A列: 開催順
  - B列: 都県名
  - C列: 抽選順
  - D列: 参加校数
- **抽選シート**: 抽選結果を管理
- **テーブルシート**: 抽選結果のテーブルを表示

## 各関数の説明

### determineLotteryOrder()
抽選順を決定する関数です。校名シートのA列（開催順）で昇順に並べ替え、抽選順（1-8）をC列に割り当てます。

### autoLotteryForTeamCompetition()
団体戦の自動抽選を行う関数です。各都県の1位から4位までの高校と5位以下の高校を抽選で配置します。
1. 校名シートをD列（参加校数）で降順、C列（抽選順）で昇順に並べ替え
2. 各都県の1位高校を抽選で配置
3. 各都県の2位高校を抽選で配置
4. 各都県の3位高校を抽選で配置
5. 各都県の4位高校を抽選で配置
6. 5位以下の高校を抽選で配置
7. 試合順を決定

### sortSchoolNames()
校名シートを並べ替える関数です。D列（参加校数）で降順、C列（抽選順）で昇順に並べ替えます。

### lotteryForFifthPlace()
5位以下の高校の抽選を行う関数です。参加校数が5校以上の都県について、5位以下の高校を抽選で配置します。

### determineMatchOrder()
試合順を決定する関数です。各試合の順番を乱数で決定します。

### initializeSheets()
シートを初期化する関数です。抽選順、テーブルシートをクリアし、データを初期状態にリセットします。

### onOpen()
スプレッドシートが開かれたときに実行される関数です。カスタムメニュー「抽選ツール」を作成します。

## 抽選ルール
- 各都県の1位校は8つのポジションに均等に配置
- 各都県の2位校は同じ都県の1位校と異なるブロックに配置
- 各都県の3位校と4位校は同じ都県の1位校・2位校と異なるゾーンに配置
- 5位以下の高校は以下の条件を満たすように配置
  - 同じグループに同都県の学校がない
  - 同じゾーンには3校まで
  - 参加校数に応じた制限（5-6校:2校まで、7-8校:3校まで、9-10校:4校まで）

## 注意事項
- 校名シートの1行目はタイトル行として扱われます
- 抽選結果はテーブルシートに表示されます
- 初期化を行うと、抽選結果がリセットされます
